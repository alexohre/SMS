<div class="d-sm-flex align-items-center justify-content-between mb-4">
	<h1 class="h3 mb-0 text-gray-800">Transactions</h1>
	<a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
</div>
<!-- Content Row -->
<div class="row">
	<!-- Content Column -->
	<div class="col-lg-12 mb-4 mx-auto">
		<!-- Project Card Example -->
		<div class="card shadow mb-4">
			<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
				<h6 class="m-0 font-weight-bold text-primary">(<%= @transactions.count %> of <%= @total_transactions %>) Transactions</h6>
				<div class="dropdown no-arrow">
					<form class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
						<div class="input-group">
							<input type="text" class="form-control bg-light border-1 small" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
							<div class="input-group-append">
								<button class="btn btn-primary" type="button">
									<i class="fas fa-search fa-sm"></i>
								</button>
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="card-body">
				<div class="table-responsive">
					<table class="table align-items-center justify-content-between">
						<thead class="thead-light">
							<tr>
								<th scope="col">Ticket ID</th>
								<th scope="col">Event Name</th>
								<th scope="col">Ticket Type</th>
								<th scope="col">Ticket Category</th>
								<th scope="col">Quantity</th>
								<th scope="col">Status</th>
								<th scope="col">Amount</th>
								<th scope="col">Action</th>
							</tr>
						</thead>
						<tbody>
							<% @transactions.each do |trans| %>
								<tr>
									<th scope="row"><%= trans.ticket_no %></th>
									<td scope="row"><%= truncate(trans.event_name, length: 50) %></td>
									<td><%= trans.ticket_type %></td>
									<td> Single </td>
									<td> 1 </td>
									<td><span class="badge badge-success"> Success </span></td>
									<td><%= number_to_currency(trans.amount, unit: "₦", precision: 2) %></td>
									<td>
										<button type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#viewTrans"
											data-event-name="<%= trans.event_name %>"
											data-ticket-price="<%= number_to_currency(trans.amount, unit: "₦", precision: 2) %>"
											data-ticket-type="<%= trans.ticket_type %>"
											data-ticket-no="<%= trans.ticket_no %>"
											data-name="<%= trans.first_name %> <%= trans.last_name %>"
											data-email="<%= trans.email %>"
											data-phone="<%= trans.phone %>"
											data-trans-date="<%= trans.created_at.strftime('%b %d, %Y') %>"
										>
											view
										</button>
									</td>
								</tr>
							<% end %>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
<%# pagination %>
<div class="pagination justify-content-center">
	<%= render 'shared/pagy', locals: {pagy: @pagy} %>
</div>
<%# modal %>
<div class="modal fade" id="viewTrans" tabindex="-1" aria-labelledby="viewTransLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title fs-5" id="viewTransLabel">Transaction Detail</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="row g-5">
					<div class="col-md-7 col-lg-12">
						<h4 class="mb-3" ><strong><span id="eventName"></span></strong></h4>
						<h4 class="mb-3" ><strong><span id="ticketNo"></span></strong></h4>
						<h5 >Ticket: <strong><span id="ticketType"></span></strong>, <span id="">seat: <strong>1</strong></span></h5>
						<h5 >Price: <strong>₦<span id="ticketPrice"></span></strong></h5>
					</div>
					<hr>
					<div class="col-md-7 col-lg-12">
						<h4 class="mb-3" ><strong><span id="name"></span></strong></h4>
						<h5 >Email: <strong><span id="email"></span></strong></h5>
						<h5 >Phone: <strong><span id="phone"></span></strong></h5>
						<h5 >Date: <strong><span id="transDate"></span></strong></h5>
					</div>
				</div>
				<div class="modal-footer mt-3">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-success disabled">Print</button>
				</div>
			</div>
		</div>
	</div>
</div>
<%# script %>
<script>
	document.addEventListener('turbo:load', function (event) {
	  var viewTransModal = document.getElementById("viewTrans");
	  viewTransModal.addEventListener("shown.bs.modal", function (event) {
	    var button = event.relatedTarget;
	    var eventName = button.getAttribute("data-event-name");
	    var ticketType = button.getAttribute("data-ticket-type");
	    var ticketPrice = button.getAttribute("data-ticket-price");
	    var ticketNo = button.getAttribute("data-ticket-no");
	    var name = button.getAttribute("data-name");
	    var email = button.getAttribute("data-email");
	    var phone = button.getAttribute("data-phone");
	    var transDate = button.getAttribute("data-trans-date");

	    var eventNameElement = document.getElementById("eventName");
	    var ticketTypeElement = document.getElementById("ticketType");
	    var ticketPriceElement = document.getElementById("ticketPrice");
	    var ticketNoElement = document.getElementById("ticketNo");
	    var nameElement = document.getElementById("name");
	    var emailElement = document.getElementById("email");
	    var phoneElement = document.getElementById("phone");
	    var transDateElement = document.getElementById("transDate");

	    eventNameElement.textContent = eventName;
	    ticketTypeElement.textContent = ticketType;
	    ticketPriceElement.textContent = ticketPrice;
	    ticketNoElement.textContent = ticketNo;
	    nameElement.textContent = name;
	    emailElement.textContent = email;
	    phoneElement.textContent = phone;
	    transDateElement.textContent = transDate;
	  });
	});
</script>
